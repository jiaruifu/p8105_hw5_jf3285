---
title: "Homework 5"
author: "Jiarui Fu"
date: "11/7/2019"
output: github_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(broom)

```

## Problem 1

```{r}
set.seed(10)

iris_with_missing = iris %>% 
  map_df(~replace(.x, sample(1:150, 20), NA)) %>%
  mutate(Species = as.character(Species))

replace_missing_values = function(x) {
  if (is.numeric(x)) {
    x=replace_na(x, mean(x, na.rm = TRUE))}
  else if (is.character(x)) {
    x=replace_na(x, "virginca")}
}

iris_new = map(iris_with_missing, replace_missing_values) 
as_tibble(iris_new)
```

## Problem 2
```{r}
files = list.files("data") 

tidy_data = tibble(filename = files) %>% 
  mutate(
    subject_info = map(filename, ~read_csv(file.path("./data", .)))
    ) %>% 
  unnest(cols = subject_info) %>% 
  janitor::clean_names() %>% 
  pivot_longer(
    week_1:week_8,
    names_to = "week", 
    values_to = "observation"
  ) %>% 
  mutate_all(~gsub("week_", "", .)) %>% 
  separate(filename, into = "id_group", sep = ".csv") %>% 
  separate(id_group, into = c("arm", "subject_id"), sep = "_") %>% 
  mutate(arm = recode(arm, "con" = "control", "exp" = "experimental")) %>% 
  mutate(observation = as.numeric(observation))

tidy_data

ggplot(tidy_data, aes(x = week, y = observation, color = arm, 
                      group = interaction(arm, subject_id))) +
  geom_line()
```



